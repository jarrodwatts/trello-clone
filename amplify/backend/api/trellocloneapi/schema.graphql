# One Board can have many columns
# One Column can have many tickets
# One Ticket can have many comments
# One Board can have One owner but many editors

# CURRENT PROBLEMS:
# - Teams can have multiple boards
# - Teams have many members of different rank
# - How do I get editors to inherit from the parent type

type Workspace
@model
@auth(
  rules: [
    # Owners of a workspace can perform any operations
    { allow: owner }
    # Members of a workspace can only read the workspace.
    {
      allow: owner, ownerField: "members", operations: [read]
    }
  ]
) {
  id: ID!
  name: String!
  description: String
  boards: [Board] @connection(keyName: "byWorkspace", fields: ["id"])
  members: [String]
  owner: String
}

type Board
@model
@key(name: "byWorkspace", fields: ["workspaceId", "name"])
@auth(
    rules: [
      # Owners of a board can perform any operations
      { allow: owner }
      # Editors of a board cannot perform delete or create board mutations
      {
        allow: owner, ownerField: "editors", operations: [read, update]
      }
    ]
  ) {
  id: ID!
  workspaceId: ID!
  name: String!
  description: String
  columns: [Column] @connection(keyName: "byBoard", fields: ["id"])
  owner: String
  editors: [String]
  visibility: Visibility
  isTemplate: Boolean
}

type Column 
@model
@key(name: "byBoard", fields: ["boardId", "name"])
@auth(
    rules: [
      # Owners of a column can perform any operations
      { allow: owner }
      # Editors of a column can perform any operations
      #{ allow: owner, ownerField: "editors" }
    ]
  )
{
  id: ID!
  boardId: ID!
  name: String!
  tickets: [Ticket] @connection(keyName: "byColumn", fields: ["id"])
  owner: String
  columnIndex: Int!
}

type Ticket
@model
@key(name: "byColumn", fields: ["columnId", "title"])
@auth(
  rules: [
      # Owners of a ticket can perform any operations
      { allow: owner }
      # Editors of a ticket can perform any operations
      #{ allow: owner, ownerField: "editors" }
    ]
)
{
  id: ID!
  columnId: ID!
  title: String!
  description: String
  comments: [Comment] @connection(keyName: "byTicket", fields: ["id"])
  labels: [Label]
  owner: String
  ticketIndex: Int!
  #editors: [String]
}

type Comment 
@model
@key(name: "byTicket", fields: ["ticketId", "content"]) 
@auth(
    rules: [
      # Owners of a comment can perform any operations
      { allow: owner }
    ]
  )
{
  id: ID!
  ticketId: ID!
  content: String!
}

type Label {
  name: String!
  color: String!
}

enum Visibility {
  Public
  Private
  Workspace
}